<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Clinic</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Volver</a>
        
        <h1>üîê Login con Keycloak</h1>
        
        <div class="card">
            <div id="loginStatus" class="status-info"></div>
            
            <div id="loginForm">
                <h3>Autenticaci√≥n</h3>
                
                <!-- Login con usuario/contrase√±a -->
                <form onsubmit="handleLogin(event)" class="login-form">
                    <div class="form-group">
                        <label for="username">Usuario:</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Contrase√±a:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn-primary">Iniciar Sesi√≥n</button>
                </form>
                
                <div class="divider">o</div>
                
                <button onclick="loginWithKeycloak()" class="btn-secondary">Login con Keycloak (OAuth2)</button>
                
                <div class="info-box">
                    <h4>Credenciales de prueba:</h4>
                    <p><strong>Usuario:</strong> test</p>
                    <p><strong>Password:</strong> test</p>
                    <p class="note">Aseg√∫rate de crear este usuario en Keycloak realm "clinic"</p>
                </div>
            </div>

            <div id="userInfo" style="display: none;">
                <h3>‚úÖ Sesi√≥n activa</h3>
                <pre id="tokenInfo"></pre>
                <button onclick="logout()" class="btn-secondary">Cerrar sesi√≥n</button>
            </div>
        </div>

        <div class="card">
            <h3>üìã Configuraci√≥n de Keycloak</h3>
            <ol>
                <li>Accede a <a href="http://localhost:8082" target="_blank">Keycloak Admin</a></li>
                <li>Crea un nuevo Realm (ej: "clinic")</li>
                <li>Crea un cliente p√∫blico:
                    <ul>
                        <li><strong>Client ID:</strong> clinic-frontend</li>
                        <li><strong>Client Type:</strong> Public</li>
                        <li><strong>Valid Redirect URIs:</strong> http://localhost:8090/*</li>
                        <li><strong>Web Origins:</strong> http://localhost:8090</li>
                    </ul>
                </li>
                <li>Crea usuarios de prueba en el realm</li>
                <li>Actualiza la configuraci√≥n en <code>app.js</code> con tu realm y client ID</li>
            </ol>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Handler para el formulario de login
        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const statusDiv = document.getElementById('loginStatus');
            
            statusDiv.innerHTML = '<p class="info">‚è≥ Iniciando sesi√≥n...</p>';
            
            const result = await loginWithPassword(username, password);
            
            if (result.success) {
                statusDiv.innerHTML = '<p class="success">‚úÖ Login exitoso! Redirigiendo...</p>';
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            } else {
                statusDiv.innerHTML = `<p class="error">‚ùå Error: ${result.error}</p>`;
            }
        }
        
        // Verificar si ya hay un token
        window.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
        });
    </script>
</body>
</html>
